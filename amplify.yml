version: 2
applications:
  - appRoot: .
    frontend:
      phases:
        preBuild:
          commands:
            - 'nvm install 20 && nvm use 20'
            - yarn install --frozen-lockfile
        build:
          commands:
            - env | grep -e ^NEXT_PUBLIC_FIREBASE_API_KEY -e ^NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN -e ^NEXT_PUBLIC_FIREBASE_PROJECT_ID -e ^NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET -e ^NEXT_PUBLIC_URL -e ^FIREBASE_PROJECT_ID -e ^FIREBASE_PRIVATE_KEY -e ^FIREBASE_CLIENT_EMAIL > .env.production
            - yarn run build
      artifacts:
        baseDirectory: .next
        files:
          - '**/*'
      cache:
        paths:
          - node_modules/**/*
